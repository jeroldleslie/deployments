---
- name: make gripper user
  user: name={{ gripper_user }} state=present
  sudo: yes

- name: make gripper group
  group: name={{ gripper_group }} state=present
  sudo: yes

# safety first, fun will follow

## Creating home dir

- name: Check if home dir is created
  stat: path={{ gripper_home_dir }}
  register: created

- name: Create Gripper home directory if it has not been created yet
  file: path={{ gripper_home_dir }} state=directory mode=755 group={{ gripper_group }} owner={{ gripper_user }}
  when: created.stat.exists == false
  sudo: yes

## Downloading Gripper

- name: Check if Gripper is already downloaded
  stat: path={{ gripper_home_dir }}/{{ gripper_tgz  }}
  register: downloaded

- name: Downloading Gripper tgz
  get_url: url={{ gripper_tgz_url  }} dest={{ gripper_home_dir }}
  when: downloaded.stat.exists == false

## Untar + unzip

- name: Check if the tgz is already unarchived
  stat: path={{ gripper_home_dir }}/bin
  register: unarchived

- name: Unarchive tgz
  unarchive: src={{ gripper_home_dir }}/{{ gripper_tgz  }} dest={{ gripper_home_dir }} copy=no
  sudo: yes
  when: unarchived.stat.exists == false

- name: Rename Gripper dir to use short path
  shell: mv {{ gripper_home_dir }}/{{ gripper_dir }}/* {{ gripper_home_dir }}/.
  sudo: yes
  when: unarchived.stat.exists == false
